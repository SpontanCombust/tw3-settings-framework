# Mod Settings Framework & Utilites for The Witcher 3

## Synopsis
Framework for modding Witcher 3 that simplifies the pipeline of using mod settings by generating code based directly on mod menu XML and allowing for notification when user changes settings in game.

## Overview
Witcher 3 allows for creating custom mod menus which provide an interface between the mod developer and the end user to further customize their experience. The way settings are accessed in game's scripts is not complicated, but can often result in very boilderplaty code and situations when settings can be fetched improperly simply due to some typo. This framework is trying to midigate.

First part of this framwork is the menu xml parser. It turns the mod menu xml into WitcherScript code which mirrors the structure of customisable variables in the xml and assures on compile time that the developer uses their variables properly - no way for typos or bad type cast.

Second part of this framework is WitcherScript code that updates generated by parser settings class and even notifies you about it.

## Instructions
1. Install the `modSettingsFramework` dependency (goes into \<witcher3_directory\>/Mods)

2. Use the `settings_parser` program with the menu xml of your mod

```shell
./settings_parser -f ~/tmp/mod-menu.xml -m MyModSettings
Group MODtab2 at line 25, column 6 has no vars and will be ignored.
Successfully parsed /home/spontan/tmp/mod-menu.xml into /home/spontan/tmp/mod-menu.ws
```
Parser takes a path to the menu xml file (-f flag) and a name you wish your settings class to have (-m flag).
To see all the possible options that can be used with the parser program use `--help` flag.

[Example mod xml](doc/mod-menu.xml)

[Generated WitcherScript code](doc/mod-menu.ws)


3. Add generated script file to your mod structure 
   

4. Let the framework know about your settings class

```js
GetSettingsMasterRegistry().AddSettings(new MyModSettings in theGame, 'MyModSettings');
```
This function has to be used only once. It is up to you when and where you use it. It can be done with Bootstrap or for example in player's OnSpawned function, your choice. The registry class should be there through the entire time the game runs and even if you try to add these settings multiple times with the same name given, the framework will detect it and won't make a duplicate.

First argument is the settings object itself.
Second argument is the ID you want this object to be identified with.


5. Retrieve settings object using the ID specified earlier and use it

```js
var settings : MyModSettings;

settings = (MyModSettings)GetSettingsMasterRegistry().GetSettings('MyModSettings');

if(settings)
{
	if(settings.tab1.toggle)
	{
		...
	}
}
```

The settings object you get always has up-to-date data stored in it, since it gets updated whenever user changes settings in the menu.

It is also possible to change values of these variables and use it to write the data back into game configuration.
```js
settings.tab2subtab1.anotherSlider = 0.8;
settings.tab2subtab2.anotherToggle = false;

settings.WriteSettings();
```


6. (Optional) You can set up a listener class that can run arbitrary code whenever user changes settings

```js
class MySettingsReadListener extends ISettingsReadListener
{
    public function OnReadSettings() : void
	{
		LogChannel( 'MyMod', "Settings have been updated!" );
	}
}

GetSettingsMasterRegistry().AddReadListener(new MySettingsReadListener in theGame);
```